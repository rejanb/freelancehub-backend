<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Room</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        #chat-log { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
        #chat-message-input { width: 80%; }
        #chat-message-submit { width: 18%; }
    </style>
</head>
<body>
    <h2>Chat Room</h2>
    <div>
        <label>Room name: <input id="room-name-input" value="room1" /></label>
        <button id="connect-btn">Connect</button>
    </div>
    <div id="chat-log"></div>
    <input id="chat-message-input" type="text" placeholder="Type your message here..." autocomplete="off" />
    <button id="chat-message-submit">Send</button>
    <script>
        let socket = null;
        let roomName = document.getElementById('room-name-input').value;
        const chatLog = document.getElementById('chat-log');
        const messageInput = document.getElementById('chat-message-input');
        const messageSubmit = document.getElementById('chat-message-submit');
        const connectBtn = document.getElementById('connect-btn');

        function appendMessage(msg) {
            chatLog.innerHTML += msg + '<br />';
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        function connect() {
            roomName = document.getElementById('room-name-input').value;
            if (socket) {
                socket.close();
            }
            socket = new WebSocket(`ws://${window.location.hostname}:8000/ws/chat/${roomName}/`);
            socket.onopen = function() {
                appendMessage('<em>Connected to room: ' + roomName + '</em>');
            };
            socket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                appendMessage(`<b>${data.sender}:</b> ${data.message}`);
            };
            socket.onclose = function() {
                appendMessage('<em>Disconnected.</em>');
            };
            socket.onerror = function(e) {
                appendMessage('<em>Error occurred.</em>');
            };
        }

        connectBtn.onclick = connect;
        messageSubmit.onclick = function() {
            if (socket && socket.readyState === WebSocket.OPEN) {
                const message = messageInput.value;
                socket.send(JSON.stringify({
                    'message': message,
                    'sender': 'user1'
                }));
                messageInput.value = '';
            }
        };
        messageInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                messageSubmit.click();
            }
        });
    </script>
</body>
</html>

